<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Territorial Online</title>

<style>
body { margin:0; overflow:hidden; background:#111; }

/* زر الرجوع */
#backBtn {
  position: fixed;
  top: 10px;
  right: 10px;
  background:#222;
  color:white;
  padding:8px 12px;
  border-radius:6px;
  border:1px solid #555;
  font-size:15px;
  z-index:1000;
}

/* زر فتح الكونسل */
#consoleBtn {
  position: fixed;
  top: 10px;
  left: 10px;
  background:#333;
  color:white;
  padding:8px 12px;
  border-radius:6px;
  border:1px solid #666;
  z-index:1000;
}

#consoleBox {
  position: fixed;
  top: 50px;
  left: 10px;
  width: 90%;
  height: 40%;
  background:#000d;
  color:#0f0;
  padding:10px;
  overflow-y:auto;
  display:none;
  border:1px solid #0f0;
}

#closeConsole {
  position: absolute;
  top: 5px;
  right: 10px;
  color:red;
  font-weight:bold;
  cursor:pointer;
}
canvas { background:black; display:block; }
</style>
</head>

<body>

<button id="backBtn" onclick="location.reload()">Back</button>
<button id="consoleBtn" onclick="toggleConsole()">Console</button>

<div id="consoleBox">
  <span id="closeConsole" onclick="toggleConsole()">X</span>
  <pre id="logArea"></pre>
</div>

<canvas id="game"></canvas>

<script>
function log(msg){
  document.getElementById("logArea").innerText += msg + "\n";
}

function toggleConsole(){
  let box = document.getElementById("consoleBox");
  box.style.display = box.style.display === "block" ? "none" : "block";
}

const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

let ws = new WebSocket("wss://" + window.location.host);
let myColor = "#fff";
let players = {};

ws.onopen = () => {
  log("Connected!");
  ws.send(JSON.stringify({ type:"join", room:"Room" }));
};

ws.onmessage = (msg) => {
  const data = JSON.parse(msg.data);

  if (data.type === "joined") {
    myColor = data.color;
    log("You joined with color: " + myColor);
  }

  if (data.type === "count") {
    log("Players in room: " + data.players);
  }

  if (data.type === "update") {
    players[data.color] = { x:data.x, y:data.y };
  }
};

ws.onerror = (e) => log("Error: "+e);
ws.onclose = () => log("Disconnected.");

document.addEventListener("mousemove", (e)=>{
  ws.send(JSON.stringify({ type:"update", x:e.clientX, y:e.clientY }));
});

function render(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  for (let c in players){
    ctx.fillStyle = c;
    ctx.beginPath();
    ctx.arc(players[c].x, players[c].y, 15, 0, Math.PI*2);
    ctx.fill();
  }

  requestAnimationFrame(render);
}
render();
</script>
</body>
</html>
